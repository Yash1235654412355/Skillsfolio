<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skillfolio – Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --dark: #23272f;
      --text: #fff;
      --accent: #37B5F2;
      --bg: #F2F2F2;
      --card: #fff;
      --shadow: 0 2px 12px rgba(46,46,46,0.08);
      --font: 'Inter', 'Poppins', Arial, sans-serif;
      --profile-gradient: linear-gradient(90deg, #37B5F2 0%, #2E2E2E 100%);
    }
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--dark);
      font-family: var(--font);
      min-height: 100vh;
    }
    .topnav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 6vw;
      background: var(--dark);
      color: var(--text);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo {
      font-weight: 800;
      font-size: 26px;
      letter-spacing: 1px;
      color: var(--accent);
    }
    .nav-links {
      display: flex;
      gap: 28px;
      font-size: 16px;
      align-items: center;
    }
    .nav-link {
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .nav-link:hover {
      color: var(--accent);
    }
    .logout-btn {
      background: var(--accent);
      color: var(--text);
      border: none;
      border-radius: 24px;
      padding: 8px 22px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      margin-left: 18px;
    }
    .notif-bell {
      font-size: 22px;
      color: var(--accent);
      background: none;
      border: none;
      cursor: pointer;
      position: relative;
      margin-right: 8px;
    }
    .notif-dot {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 8px;
      height: 8px;
      background: #ff5252;
      border-radius: 50%;
    }
    .notif-dropdown {
      display: none;
      position: fixed;
      right: 36px;
      top: 80px;
      background: var(--card);
      color: var(--dark);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(46,46,46,0.18), 0 2px 12px rgba(46,46,46,0.12);
      min-width: 260px;
      z-index: 10001;
      padding: 12px 0;
    }
    .notif-dropdown .notification {
      padding: 10px 18px;
      font-size: 15px;
      border-bottom: 1px solid #eee;
    }
    .notif-dropdown .notification:last-child {
      border-bottom: none;
    }
    .notif-more-btn {
      display: block;
      width: 100%;
      background: none;
      border: none;
      color: #7F5AF0;
      font-weight: 600;
      font-size: 15px;
      padding: 10px 0 6px 0;
      cursor: pointer;
      text-align: center;
      border-top: 1px solid #eee;
      transition: color 0.18s;
    }
    .notif-more-btn:hover { color: #00C9A7; }
    .notif-fullscreen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(30,30,40,0.92);
      z-index: 10002;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 0;
      animation: fadeInNotif 0.3s;
    }
    @keyframes fadeInNotif {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .notif-fullscreen-content {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px #7F5AF033, 0 2px 12px #00C9A722;
      max-width: 420px;
      width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      padding: 32px 24px 18px 24px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
    }
    .notif-fullscreen-title {
      font-size: 22px;
      font-weight: 700;
      color: #7F5AF0;
      margin-bottom: 18px;
      text-align: center;
    }
    .notif-fullscreen .notification {
      color: #23272f;
      background: #f8fbfd;
      border-radius: 10px;
      margin-bottom: 10px;
      padding: 12px 16px;
      font-size: 16px;
      box-shadow: 0 2px 8px #7F5AF011;
    }
    .notif-fullscreen-back {
      position: absolute;
      top: 16px;
      right: 18px;
      background: none;
      border: none;
      color: #7F5AF0;
      font-size: 22px;
      font-weight: 700;
      cursor: pointer;
      transition: color 0.18s;
    }
    .notif-fullscreen-back:hover { color: #00C9A7; }
    .profile-layout {
      display: flex;
      gap: 0 !important;
      width: 100vw !important;
      max-width: 100vw !important;
      margin: 0 !important;
      padding: 0 !important;
      min-height: 70vh;
      box-sizing: border-box;
    }
    .profile-left {
      flex: 0 0 20vw;
      max-width: 20vw;
      min-width: 200px;
      background: var(--card);
      border-right: 1.5px solid #e3f2fd;
      box-sizing: border-box;
      height: calc(100vh - 72px - 1px);
    }
    .profile-card {
      background: var(--card);
      border-radius: 22px;
      box-shadow: 0 4px 24px #37B5F211, var(--shadow);
      padding: 36px 24px 24px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-bottom: 24px;
    }
    .avatar {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: 3px solid var(--bg);
      object-fit: cover;
      margin-bottom: 10px;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: var(--accent);
      font-weight: 700;
    }
    .profile-name {
      font-size: 19px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 2px;
      text-align: center;
    }
    .profile-email {
      font-size: 14px;
      color: #555;
      margin-bottom: 6px;
      text-align: center;
    }
    .profile-bio {
      font-size: 13px;
      color: #888;
      margin-bottom: 6px;
      text-align: center;
    }
    .profile-middle {
      flex: 1 1 80vw;
      min-width: 0;
      background: var(--bg);
      height: calc(100vh - 72px - 1px);
      box-sizing: border-box;
      overflow-x: hidden;
    }
    .viewed-profile-card {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 2px 12px #37B5F111, var(--shadow);
      padding: 0 0 18px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-bottom: 18px;
      position: relative;
      overflow: hidden;
    }
    .profile-banner {
      width: 100%;
      height: 100%;
      min-height: 240px;
      background: linear-gradient(120deg, #7F5AF0 0%, #00C9A7 50%, #FF6AC2 100%);
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      box-shadow: 0 4px 32px #7F5AF033, 0 2px 8px #00C9A722;
      z-index: 1;
      overflow: hidden;
    }
    .profile-banner::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(30,30,40,0.55);
      transition: background 0.35s;
      z-index: 2;
    }
    .profile-banner:hover::after {
      background: rgba(30,30,40,0.15);
    }
    .viewed-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 3px solid var(--bg);
      object-fit: cover;
      margin-bottom: 12px;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--accent);
      font-weight: 700;
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 3;
      box-shadow: 0 4px 24px #7F5AF044;
    }
    .viewed-profile-content {
      margin-top: 90px;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      z-index: 4;
      position: relative;
      padding: 0 32px;
      color: #fff;
      text-shadow: 0 2px 8px #23272f33;
    }
    .viewed-profile-name, .viewed-profile-email, .viewed-profile-bio, .viewed-profile-location, .viewed-profile-stats, .view-resume-btn {
      color: #fff;
      text-shadow: 0 2px 8px #23272f33;
    }
    .view-resume-btn {
      background: #fff;
      color: #37B5F2;
      border: none;
      border-radius: 18px;
      padding: 8px 22px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 2px 8px #37B5F222;
      margin-top: 10px;
    }
    .sidebar {
      display: flex;
      gap: 0;
      background: var(--card);
      border-radius: 18px 18px 0 0;
      box-shadow: 0 2px 12px #37B5F111, var(--shadow);
      overflow: hidden;
      margin-bottom: 0;
    }
    .sidebar-btn {
      flex: 1;
      background: none;
      border: none;
      color: var(--dark);
      font-size: 17px;
      font-weight: 600;
      padding: 16px 0;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
      outline: none;
      border-bottom: 2px solid transparent;
    }
    .sidebar-btn.active, .sidebar-btn:hover {
      background: var(--accent);
      color: var(--text);
      border-bottom: 2px solid var(--accent);
    }
    .main-content {
      background: none;
      border-radius: 0 0 18px 18px;
      box-shadow: none;
      padding: 0;
      min-height: 300px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      margin-bottom: 0;
    }
    .card {
      background: var(--bg);
      border-radius: 14px;
      box-shadow: 0 1px 6px rgba(46,46,46,0.06);
      padding: 16px 16px 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 80px;
      position: relative;
    }
    .card .icon {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 22px;
      color: var(--accent);
    }
    .card-title {
      font-weight: 700;
      font-size: 17px;
      margin-bottom: 2px;
    }
    .card-desc {
      font-size: 15px;
      color: #444;
      margin-bottom: 2px;
    }
    .card-meta {
      font-size: 13px;
      color: #888;
      margin-top: 2px;
    }
    .empty-state {
      text-align: center;
      padding: 32px;
      background: var(--bg);
      border-radius: 14px;
      color: #888;
    }
    .profile-right {
      display: none !important;
    }
    .chat-nav-btn {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 24px;
      position: relative;
      cursor: pointer;
      margin-right: 8px;
      display: flex;
      align-items: center;
    }
    .chat-badge {
      position: absolute;
      top: 0px;
      right: -2px;
      background: #25d366;
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      border-radius: 50%;
      padding: 2px 6px;
      min-width: 20px;
      text-align: center;
      box-shadow: 0 2px 8px #25d36644;
    }
    .chat-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(30,30,40,0.92);
      z-index: 10002;
      align-items: center;
      justify-content: center;
    }
    .chat-overlay.active {
      display: flex;
    }
    .chat-panel {
      display: flex;
      width: 90vw;
      max-width: 1100px;
      height: 80vh;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px #37B5F233, 0 2px 12px #00C9A722;
      overflow: hidden;
    }
    .chat-list {
      width: 320px;
      background: #f8fbfd;
      border-right: 1.5px solid #e3f2fd;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .chat-list-header {
      padding: 18px 18px 10px 18px;
      font-weight: 700;
      font-size: 18px;
      color: var(--accent);
      border-bottom: 1.5px solid #e3f2fd;
      background: #fff;
    }
    .chat-list-contacts {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }
    .chat-contact {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 18px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.15s;
      position: relative;
    }
    .chat-contact.active, .chat-contact:hover {
      background: #e5f6fd;
    }
    .chat-contact-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #37B5F2 0%, #e0e0e0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
      font-weight: 700;
      box-shadow: 0 2px 8px #37B5F222;
    }
    .chat-contact-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .chat-contact-name {
      font-weight: 600;
      font-size: 15px;
      color: #23272f;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chat-contact-last {
      font-size: 13px;
      color: #888;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }
    .chat-contact-unread {
      background: #25d366;
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      border-radius: 50%;
      padding: 2px 6px;
      min-width: 20px;
      text-align: center;
      position: absolute;
      right: 18px;
      top: 18px;
      box-shadow: 0 2px 8px #25d36644;
    }
    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      background: var(--chat-bg);
      position: relative;
    }
    .chat-main-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 18px 24px;
      background: #fff;
      border-bottom: 1.5px solid #e3f2fd;
      font-weight: 700;
      font-size: 17px;
      color: var(--accent);
    }
    .chat-main-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px 24px 0 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: none;
      min-height: 180px;
      scrollbar-width: thin;
      scrollbar-color: #37B5F2 #e0f7fa;
    }
    .chat-message {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      margin-bottom: 2px;
    }
    .chat-message.me {
      flex-direction: row-reverse;
    }
    .chat-bubble {
      max-width: 70%;
      padding: 10px 16px;
      border-radius: 18px 18px 6px 18px;
      background: var(--chat-me);
      color: #fff;
      font-size: 15px;
      box-shadow: 0 2px 8px #37B5F222;
      word-break: break-word;
      transition: background 0.2s;
    }
    .chat-message.me .chat-bubble {
      background: #fff;
      color: #23272f;
      border-radius: 18px 18px 18px 6px;
      border: 1.5px solid #b2ebf2;
    }
    .chat-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #37B5F2 0%, #e0e0e0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      color: #fff;
      font-weight: 700;
      box-shadow: 0 2px 8px #37B5F222;
    }
    .chat-input-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 14px 18px 14px 18px;
      background: #fff;
      border-top: 1.5px solid #e3f2fd;
      position: relative;
      box-shadow: 0 -2px 8px #37B5F211;
    }
    .chat-junction-btn {
      background: none;
      border: none;
      font-size: 22px;
      color: #37B5F2;
      margin-right: 6px;
      cursor: pointer;
      border-radius: 50%;
      padding: 4px;
      transition: background 0.15s;
      position: relative;
      z-index: 2;
    }
    .chat-junction-btn:hover {
      background: #e0f7fa;
    }
    .chat-junction-menu {
      display: none;
      position: absolute;
      bottom: 54px;
      left: 10px;
      background: #fff;
      border: 1.5px solid #e3f2fd;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(46,46,46,0.10);
      padding: 8px 0;
      z-index: 10;
      min-width: 120px;
      flex-direction: column;
      gap: 0;
    }
    .chat-junction-item {
      background: none;
      border: none;
      color: #23272f;
      font-size: 16px;
      padding: 8px 18px;
      text-align: left;
      cursor: pointer;
      width: 100%;
      border-radius: 0;
      transition: background 0.12s;
    }
    .chat-junction-item:hover {
      background: #e0f7fa;
    }
    .chat-input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 18px;
      border: 1.5px solid #b2ebf2;
      font-size: 15px;
      background: #f8fbfd;
      box-shadow: 0 1px 4px #37B5F211;
      outline: none;
      transition: border 0.2s;
    }
    .chat-input:focus {
      border: 1.5px solid #37B5F2;
    }
    .chat-send-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 18px;
      padding: 8px 18px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      margin-left: 8px;
      transition: background 0.2s;
    }
    .chat-send-btn:hover { background: #25d366; }
    .chat-close-btn {
      position: absolute;
      top: 12px;
      right: 18px;
      background: none;
      border: none;
      color: #37B5F2;
      font-size: 28px;
      font-weight: 700;
      cursor: pointer;
      z-index: 102;
    }
    .nav-search {
      padding: 7px 16px;
      border-radius: 18px;
      border: 1.5px solid #b2ebf2;
      font-size: 15px;
      background: #f8fbfd;
      color: #23272f;
      margin: 0 12px;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
      min-width: 120px;
      max-width: 220px;
    }
    .nav-search:focus {
      border: 1.5px solid #37B5F2;
      box-shadow: 0 2px 8px #37B5F222;
    }
    @media (max-width: 700px) {
      .nav-search { min-width: 60px; max-width: 100px; font-size: 13px; padding: 6px 8px; }
    }
  </style>
</head>
<body>
  <div class="topnav">
    <div class="logo">Skillfolio</div>
    <div class="nav-links">
      <a href="dashboard.html" class="nav-link">Dashboard</a>
      <a href="index.html" class="nav-link">Home</a>
      <a href="profile.html" class="nav-link" style="color:var(--accent);font-weight:700;">Profile</a>
      <input class="nav-search" id="nav-search" type="text" placeholder="Search..." />
      <button class="notif-bell" id="notif-bell">
        🔔<span class="notif-dot"></span>
        <div class="notif-dropdown" id="notif-dropdown">
        </div>
      </button>
      <button class="chat-nav-btn" id="chat-nav-btn" title="Inbox">
        💬<span class="chat-badge" id="chat-badge">2</span>
      </button>
      <button id="logout" class="logout-btn">Logout</button>
    </div>
  </div>
  <div class="profile-layout">
    <div class="profile-left">
      <div class="profile-card">
        <div class="avatar">PS</div>
        <div class="profile-name">Priya S.</div>
        <div class="profile-email">priya.singh@email.com</div>
        <div class="profile-bio">AI/ML Enthusiast | Open Source | Mentor</div>
      </div>
    </div>
    <div class="profile-middle">
      <div class="viewed-profile-card">
        <div class="profile-banner"></div>
        <div class="viewed-avatar">JD</div>
        <div class="viewed-profile-content">
          <div class="viewed-profile-name">Jane Doe</div>
          <div class="viewed-profile-email">jane.doe@example.com</div>
          <div class="viewed-profile-bio">Full Stack Developer | Hackathon Winner | Lifelong Learner</div>
          <div class="viewed-profile-location">📍 San Francisco, CA</div>
          <div class="viewed-profile-stats">
            <div><b id="stat-posts">5</b><br><span style="font-size:13px;color:#fff;">Posts</span></div>
            <div><b id="stat-projects">3</b><br><span style="font-size:13px;color:#fff;">Projects</span></div>
            <div><b id="stat-achievements">4</b><br><span style="font-size:13px;color:#fff;">Achievements</span></div>
          </div>
          <button class="view-resume-btn">View Resume</button>
        </div>
      </div>
      <div class="sidebar">
        <button class="sidebar-btn active" id="btn-posts">Posts</button>
        <button class="sidebar-btn" id="btn-projects">Projects</button>
        <button class="sidebar-btn" id="btn-achievements">Achievements</button>
      </div>
      <div class="main-content">
        <div id="posts-section">
          <div id="posts-grid" class="grid"></div>
        </div>
        <div id="projects-section" style="display:none;">
          <div id="projects-grid" class="grid"></div>
        </div>
        <div id="achievements-section" style="display:none;">
          <div id="achievements-grid" class="grid"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Add chat overlay from index.html -->
  <div class="chat-overlay" id="chat-overlay">
    <div class="chat-panel">
      <div class="chat-list">
        <div class="chat-list-header">Chats</div>
        <div class="chat-list-contacts" id="chat-list-contacts"></div>
      </div>
      <div class="chat-main">
        <div class="chat-main-header" id="chat-main-header">Select a chat</div>
        <div class="chat-main-messages" id="chat-main-messages"></div>
        <div class="chat-input-row">
          <button class="chat-junction-btn" id="chat-junction-btn" title="More actions">⋮</button>
          <div class="chat-junction-menu" id="chat-junction-menu">
            <button class="chat-junction-item" id="junction-emoji">😊 Emoji</button>
            <button class="chat-junction-item" id="junction-attach">📎 Attach</button>
            <button class="chat-junction-item" id="junction-call">📞 Call</button>
          </div>
          <input class="chat-input" id="chat-input" type="text" placeholder="Type a message..." />
          <button class="chat-send-btn" id="chat-send">Send</button>
        </div>
        <button class="chat-close-btn" id="chat-close-btn">×</button>
      </div>
    </div>
  </div>
  <div id="notif-fullscreen" class="notif-fullscreen" style="display:none;">
    <div class="notif-fullscreen-content">
      <button class="notif-fullscreen-back" id="notif-fullscreen-back">×</button>
      <div class="notif-fullscreen-title">All Notifications</div>
      <div id="notif-fullscreen-list"></div>
    </div>
  </div>
  <script>
    const API_URL = 'http://localhost:4000/api';
    let loggedInUser = null; // Will be set on page load
    let viewedUserId = null; // The ID of the profile being viewed

    document.addEventListener('DOMContentLoaded', async () => {
      // 1. Get logged-in user from localStorage
      const userData = localStorage.getItem('user');
      const token = localStorage.getItem('token');
      if (userData && token) {
        loggedInUser = JSON.parse(userData);
      } else {
        // If no user data, redirect to login. For now, we'll just log a warning.
        console.warn("Not logged in. Redirect to login page should happen here.");
        // window.location.href = 'login.html';
        return;
      }

      // 2. Determine which user profile to load
      const urlParams = new URLSearchParams(window.location.search);
      viewedUserId = urlParams.get('id') || loggedInUser.id; // View own profile if no ID in URL

      // 3. Fetch and render profile data
      await fetchAndRenderProfile(viewedUserId);

      // 4. Setup page event listeners
      setupEventListeners();
    });
    
    async function fetchAndRenderProfile(userId) {
      try {
        const res = await fetch(`${API_URL}/users/${userId}/profile`);
        if (!res.ok) {
          document.body.innerHTML = `<h1>Error: Could not load profile.</h1><p>${await res.text()}</p>`;
          return;
        }
        const data = await res.json();
        const { user, posts, projects, achievements } = data;

        // Render Profile Card (left sidebar - the logged in user)
        document.querySelector('.profile-card .avatar').textContent = loggedInUser.avatar_initials || loggedInUser.name.substring(0, 2).toUpperCase();
        document.querySelector('.profile-card .profile-name').textContent = loggedInUser.name;
        document.querySelector('.profile-card .profile-email').textContent = loggedInUser.email;
        document.querySelector('.profile-card .profile-bio').textContent = loggedInUser.bio || 'No bio yet.';

        // Render Viewed Profile (main content)
        document.querySelector('.viewed-avatar').textContent = user.avatar_initials || user.name.substring(0, 2).toUpperCase();
        document.querySelector('.viewed-profile-name').textContent = user.name;
        document.querySelector('.viewed-profile-email').textContent = user.email;
        document.querySelector('.viewed-profile-bio').textContent = user.bio || 'No bio yet.';
        document.getElementById('stat-posts').textContent = posts.length;
        document.getElementById('stat-projects').textContent = projects.length;
        document.getElementById('stat-achievements').textContent = achievements.length;
        
        // Render Grids
        renderGrid('posts-grid', posts, 'post');
        renderGrid('projects-grid', projects, 'project');
        renderGrid('achievements-grid', achievements, 'achievement');

      } catch (error) {
        console.error('Failed to fetch profile:', error);
        document.body.innerHTML = '<h1>Error loading profile data. Is the backend server running?</h1>';
      }
    }

    function setupEventListeners() {
      // Sidebar navigation logic
      const btnPosts = document.getElementById('btn-posts');
      const btnProjects = document.getElementById('btn-projects');
      const btnAchievements = document.getElementById('btn-achievements');
      const postsSection = document.getElementById('posts-section');
      const projectsSection = document.getElementById('projects-section');
      const achievementsSection = document.getElementById('achievements-section');

      btnPosts.addEventListener('click', () => {
        btnPosts.classList.add('active');
        btnProjects.classList.remove('active');
        btnAchievements.classList.remove('active');
        postsSection.style.display = '';
        projectsSection.style.display = 'none';
        achievementsSection.style.display = 'none';
      });
      btnProjects.addEventListener('click', () => {
        btnPosts.classList.remove('active');
        btnProjects.classList.add('active');
        btnAchievements.classList.remove('active');
        postsSection.style.display = 'none';
        projectsSection.style.display = '';
        achievementsSection.style.display = 'none';
      });
      btnAchievements.addEventListener('click', () => {
        btnPosts.classList.remove('active');
        btnProjects.classList.remove('active');
        btnAchievements.classList.add('active');
        postsSection.style.display = 'none';
        projectsSection.style.display = 'none';
        achievementsSection.style.display = '';
      });

      // Logout
      document.getElementById('logout').addEventListener('click', () => {
        localStorage.removeItem('user');
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      });
      
      // Other event listeners (chat, notifications) can be ported over and connected to APIs as well.
      // For now, keeping the mock chat functionality to demonstrate the profile page connection.
      setupMockChat(); 
    }

    // Render grid items (posts, projects, achievements)
    function renderGrid(gridId, items, type) {
      const grid = document.getElementById(gridId);
      grid.innerHTML = '';
      if (!items.length) {
        grid.innerHTML = `<div class=\"empty-state\">No ${type}s found.</div>`;
        return;
      }
      items.forEach((item, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        if (type === 'post') {
          // Like/React combined
          item.likes = item.likes || 0;
          item.reaction = item.reaction || '';
          item.comments = item.comments || [];
          card.innerHTML = `
            <span class=\"icon\">${item.icon || ''}</span>
            <div class=\"card-title\">${item.title}</div>
            <div class=\"card-desc\">${item.description || ''}</div>
            <div class=\"card-meta\">${item.date || new Date(item.created_at).toLocaleDateString()}</div>
            <div style=\"display:flex;gap:10px;margin-top:8px;align-items:center;\">
              <button class=\"like-react-btn\" style=\"background:#fff;color:#37B5F2;border:1.5px solid #37B5F2;border-radius:12px;padding:4px 14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:4px;\">
                <span class=\"like-emoji\">${item.reaction || '👍'}</span> <span class=\"like-count\">${item.likes}</span>
              </button>
              <button class=\"react-picker-btn\" style=\"background:#fff;color:#37B5F2;border:1.5px solid #37B5F2;border-radius:12px;padding:4px 10px;font-weight:600;cursor:pointer;\">😊</button>
              <button class=\"comment-btn\" style=\"background:#fff;color:#37B5F2;border:1.5px solid #37B5F2;border-radius:12px;padding:4px 10px;font-weight:600;cursor:pointer;\">💬 Comment</button>
              <button class=\"share-btn\" style=\"background:#fff;color:#37B5F2;border:1.5px solid #37B5F2;border-radius:12px;padding:4px 10px;font-weight:600;cursor:pointer;\">🔗 Share</button>
            </div>
            <div class=\"react-picker\" style=\"display:none;margin-top:6px;\">
              <span class=\"react-emoji\" style=\"font-size:20px;cursor:pointer;\">👍</span>
              <span class=\"react-emoji\" style=\"font-size:20px;cursor:pointer;\">❤️</span>
              <span class=\"react-emoji\" style=\"font-size:20px;cursor:pointer;\">😂</span>
              <span class=\"react-emoji\" style=\"font-size:20px;cursor:pointer;\">😮</span>
              <span class=\"react-emoji\" style=\"font-size:20px;cursor:pointer;\">😢</span>
            </div>
            <div class=\"comment-section\" style=\"display:none;margin-top:10px;\">
              <input class=\"comment-input\" type=\"text\" placeholder=\"Write a comment...\" style=\"width:80%;padding:6px 10px;border-radius:8px;border:1px solid #ccc;\" />
              <button class=\"add-comment-btn\" style=\"background:#37B5F2;color:#fff;border:none;border-radius:8px;padding:6px 14px;margin-left:6px;cursor:pointer;\">Post</button>
              <div class=\"comment-list\" style=\"margin-top:8px;\"></div>
            </div>
          `;
        } else if (type === 'project') {
          card.innerHTML = `
            <span class=\"icon\">${item.icon || ''}</span>
            <div class=\"card-title\">${item.title}</div>
            <div class=\"card-desc\">${item.description || ''}</div>
            <div class=\"card-meta\"><b>Tags:</b> ${item.tags || ''}</div>
            <button style=\"margin-top:8px;background:#37B5F2;color:#fff;border:none;border-radius:12px;padding:4px 16px;font-weight:600;cursor:pointer;\">View Project</button>
          `;
        } else {
          card.innerHTML = `
            <span class=\"icon\">${item.icon || ''}</span>
            <div class=\"card-title\">${item.title}</div>
            <div class=\"card-desc\">${item.description || ''}</div>
            <div class=\"card-meta\">${item.type || ''} ${item.date || ''}</div>
          `;
        }
        grid.appendChild(card);

        // --- Interactivity for posts ---
        if (type === 'post') {
          const likeReactBtn = card.querySelector('.like-react-btn');
          const likeCount = card.querySelector('.like-count');
          const likeEmoji = card.querySelector('.like-emoji');
          likeReactBtn.addEventListener('click', () => {
            item.likes++;
            likeCount.textContent = item.likes;
          });

          const reactPickerBtn = card.querySelector('.react-picker-btn');
          const reactPicker = card.querySelector('.react-picker');
          reactPickerBtn.addEventListener('click', () => {
            reactPicker.style.display = reactPicker.style.display === 'none' ? '' : 'none';
          });
          reactPicker.querySelectorAll('.react-emoji').forEach(emoji => {
            emoji.addEventListener('click', () => {
              item.reaction = emoji.textContent;
              likeEmoji.textContent = item.reaction;
              reactPicker.style.display = 'none';
            });
          });

          const commentBtn = card.querySelector('.comment-btn');
          const commentSection = card.querySelector('.comment-section');
          const commentInput = card.querySelector('.comment-input');
          const addCommentBtn = card.querySelector('.add-comment-btn');
          const commentList = card.querySelector('.comment-list');
          commentBtn.addEventListener('click', () => {
            commentSection.style.display = commentSection.style.display === 'none' ? '' : 'none';
            renderComments();
          });
          addCommentBtn.addEventListener('click', () => {
            if (commentInput.value.trim()) {
              item.comments.push({ user: 'You', text: commentInput.value });
              commentInput.value = '';
              renderComments();
            }
          });
          function renderComments() {
            commentList.innerHTML = '';
            item.comments.forEach(c => {
              const div = document.createElement('div');
              div.style.marginBottom = '4px';
              div.style.fontSize = '14px';
              div.innerHTML = `<b>${c.user}:</b> ${c.text}`;
              commentList.appendChild(div);
            });
          }

          const shareBtn = card.querySelector('.share-btn');
          shareBtn.addEventListener('click', () => {
            const mockLink = `https://skillfolio.app/post/${idx+1}`;
            navigator.clipboard.writeText(mockLink);
            shareBtn.textContent = '✅ Copied!';
            setTimeout(() => { shareBtn.textContent = '🔗 Share'; }, 1200);
          });
        }
      });
    }

    // This part remains mock for now, can be connected later
    function setupMockChat() {
        const chatContacts = [
          { id: 1, name: 'Alex Kim', avatar: 'AK', last: 'Let\'s collaborate on the new project.', unread: 1 },
          { id: 2, name: 'Samira R.', avatar: 'SR', last: 'Congrats on your achievement! 🎉', unread: 1 },
          { id: 3, name: 'Jane Doe', avatar: 'JD', last: 'Hey, this is my own chat!', unread: 0 },
        ];
        const chatData = {
          1: [ { me: false, text: 'Let\'s collaborate on the new project.' }, { me: true, text: 'Sounds great, Alex!' } ],
          2: [ { me: false, text: 'Congrats on your achievement! 🎉' }, { me: true, text: 'Thank you, Samira!' } ],
          3: [ { me: true, text: 'Hey, this is my own chat!' } ]
        };
        let currentChatId = null;
        function renderChatContacts() {
          const contactsDiv = document.getElementById('chat-list-contacts');
          contactsDiv.innerHTML = '';
          chatContacts.forEach(c => {
            const div = document.createElement('div');
            div.className = 'chat-contact' + (c.id === currentChatId ? ' active' : '');
            div.innerHTML = `<div class="chat-contact-avatar">${c.avatar}</div><div class="chat-contact-info"><div class="chat-contact-name">${c.name}</div><div class="chat-contact-last">${c.last}</div></div>${c.unread ? `<span class='chat-contact-unread'>${c.unread}</span>` : ''}`;
            div.addEventListener('click', () => {
              currentChatId = c.id;
              c.unread = 0;
              renderChatContacts();
              renderChatMain();
              updateChatBadge();
            });
            contactsDiv.appendChild(div);
          });
        }
        function renderChatMain() {
          const header = document.getElementById('chat-main-header');
          const messagesDiv = document.getElementById('chat-main-messages');
          if (!currentChatId) {
            header.textContent = 'Select a chat';
            messagesDiv.innerHTML = '';
            return;
          }
          const contact = chatContacts.find(c => c.id === currentChatId);
          header.innerHTML = `<span class='chat-contact-avatar'>${contact.avatar}</span> ${contact.name}`;
          messagesDiv.innerHTML = '';
          (chatData[currentChatId] || []).forEach(msg => {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chat-message' + (msg.me ? ' me' : '');
            msgDiv.innerHTML = `<div class='chat-avatar'>${msg.me ? (loggedInUser.avatar_initials || 'ME') : contact.avatar}</div><div class='chat-bubble'>${msg.text}</div>`;
            messagesDiv.appendChild(msgDiv);
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        function updateChatBadge() {
          const badge = document.getElementById('chat-badge');
          const unread = chatContacts.reduce((sum, c) => sum + (c.unread || 0), 0);
          badge.textContent = unread;
          badge.style.display = unread ? 'inline-block' : 'none';
        }
        function sendMessage() {
          if (!currentChatId) return;
          const val = chatInput.value.trim();
          if (!val) return;
          chatData[currentChatId].push({ me: true, text: val });
          chatInput.value = '';
          renderChatMain();
        }

        renderChatContacts();
        renderChatMain();
        updateChatBadge();

        const chatNavBtn = document.getElementById('chat-nav-btn');
        const chatOverlay = document.getElementById('chat-overlay');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        chatNavBtn.addEventListener('click', e => { e.stopPropagation(); chatOverlay.classList.add('active'); });
        chatCloseBtn.addEventListener('click', () => { chatOverlay.classList.remove('active'); });
        chatOverlay.addEventListener('click', e => { if (e.target === chatOverlay) chatOverlay.classList.remove('active'); });

        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
        
        const junctionBtn = document.getElementById('chat-junction-btn');
        const junctionMenu = document.getElementById('chat-junction-menu');
        junctionBtn.addEventListener('click', e => {
          e.stopPropagation();
          junctionMenu.style.display = junctionMenu.style.display === 'block' ? 'none' : 'block';
        });
        document.body.addEventListener('click', () => { junctionMenu.style.display = 'none'; });
        document.getElementById('junction-emoji').addEventListener('click', e => {
            e.preventDefault();
            document.getElementById('chat-input').value += '😊';
            junctionMenu.style.display = 'none';
            document.getElementById('chat-input').focus();
        });
        document.getElementById('junction-attach').addEventListener('click', e => {
            e.preventDefault();
            alert('Attachment feature coming soon!');
            junctionMenu.style.display = 'none';
        });
        document.getElementById('junction-call').addEventListener('click', e => {
            e.preventDefault();
            alert('Call feature coming soon!');
            junctionMenu.style.display = 'none';
        });
    }
  </script>
</body>
</html>